<div class="w-80 bg-gray-900 border-r border-gray-700 overflow-y-auto">
  <div class="p-4 border-b border-gray-700">
    <div class="flex gap-2">
      <button
        (click)="onViewChange('chat')"
        [class]="
          activeView === 'chat'
            ? 'flex-1 py-2 px-3 rounded-lg font-medium transition-colors bg-blue-600 text-white'
            : 'flex-1 py-2 px-3 rounded-lg font-medium transition-colors bg-gray-800 text-gray-300 hover:bg-gray-700'
        "
      >
        Minhas Conversas
      </button>
      <button
        (click)="onViewChange('available-groups')"
        [class]="
          activeView === 'available-groups'
            ? 'flex-1 py-2 px-3 rounded-lg font-medium transition-colors bg-blue-600 text-white'
            : 'flex-1 py-2 px-3 rounded-lg font-medium transition-colors bg-gray-800 text-gray-300 hover:bg-gray-700'
        "
      >
        üîç Encontrar
      </button>
    </div>
  </div>

  <!-- Chat View -->
  @if (activeView === 'chat') {
    <div class="p-4">
      <!-- User Chats -->
      <div class="mb-6">
        <h3 class="font-bold text-gray-300 mb-3 flex items-center gap-2">üí¨ Conversas Diretas</h3>
        <div class="space-y-2">
          @for (chat of userChats; track chat.id) {
            <div
              (click)="onChatSelect('user', chat.id, chat.name)"
              [class]="
                isSelected('user', chat.id)
                  ? 'p-3 rounded-lg cursor-pointer transition-colors bg-blue-600'
                  : 'p-3 rounded-lg cursor-pointer transition-colors bg-gray-800 hover:bg-gray-750'
              "
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div
                    [class]="
                      chat.online
                        ? 'w-2 h-2 rounded-full bg-green-500'
                        : 'w-2 h-2 rounded-full bg-gray-500'
                    "
                  ></div>
                  <span class="font-medium text-white">{{ chat.name }}</span>
                </div>
                @if (chat.unread > 0) {
                  <span
                    class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center"
                  >
                    {{ chat.unread }}
                  </span>
                }
              </div>
              @if (!chat.online) {
                <div class="text-xs text-gray-400 mt-1 ml-4">Visto {{ chat.lastSeen }}</div>
              }
            </div>
          }
          @if (userChats.length === 0) {
            <div class="text-center text-gray-500 text-sm py-4">Nenhum usu√°rio online ainda</div>
          }
        </div>
      </div>

      <!-- Group Chats -->
      <div>
        <div class="flex justify-between items-center mb-3">
          <h3 class="font-bold text-gray-300 flex items-center gap-2">üë• Meus Grupos</h3>
          <button
            (click)="onCreateGroup()"
            class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm font-semibold transition-colors"
          >
            + Novo
          </button>
        </div>
        <div class="space-y-2">
          @for (group of groupChats; track group.id) {
            <div
              (click)="onChatSelect('group', group.id, group.name)"
              [class]="
                isSelected('group', group.id)
                  ? 'p-3 rounded-lg cursor-pointer transition-colors bg-blue-600'
                  : 'p-3 rounded-lg cursor-pointer transition-colors bg-gray-800 hover:bg-gray-750'
              "
            >
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="font-medium text-white">{{ group.name }}</div>
                  <div class="text-xs text-gray-400">L√≠der: {{ group.leader }}</div>
                  <div class="text-xs text-gray-500">{{ group.members }} membros</div>
                </div>
                <div class="flex flex-col items-end gap-1">
                  <span
                    [class]="
                      group.leader === username
                        ? 'text-xs px-2 py-1 rounded-full bg-green-900 text-green-300'
                        : 'text-xs px-2 py-1 rounded-full bg-blue-900 text-blue-300'
                    "
                  >
                    {{ group.leader === username ? 'L√≠der' : 'Membro' }}
                  </span>
                  @if (group.unread > 0) {
                    <span
                      class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center"
                    >
                      {{ group.unread }}
                    </span>
                  }
                </div>
              </div>
            </div>
          }
          @if (groupChats.length === 0) {
            <div class="text-center text-gray-500 text-sm py-4">Nenhum grupo criado ainda</div>
          }
        </div>
      </div>
    </div>
  }

  <!-- Available Groups View -->
  @if (activeView === 'available-groups') {
    <div class="p-4">
      <h3 class="font-bold text-gray-300 mb-3 flex items-center gap-2">üîç Grupos Dispon√≠veis</h3>
      <div class="space-y-3">
        @for (group of availableGroups; track group.id) {
          <div class="p-4 rounded-lg bg-gray-800 border border-gray-700">
            <div class="font-medium text-white mb-1">{{ group.name }}</div>
            <div class="text-xs text-gray-400 mb-2">{{ group.description }}</div>
            <div class="flex justify-between items-center">
              <div class="text-xs text-gray-500">
                <div>L√≠der: {{ group.leader }}</div>
                <div>{{ group.members }} membros</div>
              </div>
              <button
                (click)="onJoinGroup(group.id)"
                class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm font-semibold transition-colors"
              >
                Entrar
              </button>
            </div>
          </div>
        }
        @if (availableGroups.length === 0) {
          <div class="text-center text-gray-500 text-sm py-4">
            Nenhum grupo dispon√≠vel no momento
          </div>
        }
      </div>
    </div>
  }

  <!-- Modal de Criar Grupo - AGORA DENTRO DA SIDEBAR -->
  <app-group-modal
    [showModal]="showCreateGroupModal"
    [newGroupName]="newGroupName"
    (modalClose)="onModalClose()"
    (groupCreate)="onModalGroupCreate()"
    (groupNameChange)="onModalGroupNameChange($event)"
    (modalKeyPress)="onModalKeyPress($event)"
  ></app-group-modal>
</div>
