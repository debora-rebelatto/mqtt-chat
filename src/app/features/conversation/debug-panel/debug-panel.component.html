<div class="bg-gray-800 rounded-lg p-4">
  <div class="flex justify-between items-center mb-3">
    <h3 class="text-lg font-bold text-white">{{ 'DEBUG_PANEL' | translate }}</h3>
    <div class="flex gap-2">
      <button
        (click)="testPersistence()"
        class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"
      >
        Testar
      </button>
      <button
        (click)="clearDebugHistory()"
        class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"
      >
        {{ 'CLEAR' | translate }}
      </button>
      <button
        (click)="toggleDebug()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"
      >
        {{ showDebug ? ('HIDE' | translate) : ('SHOW' | translate) }}
      </button>
    </div>
  </div>

  @if (showDebug) {
    <!-- Estatísticas -->
    <div class="grid grid-cols-3 gap-4 mb-4">
      <div class="bg-gray-700 rounded p-3 text-center">
        <div class="text-2xl font-bold text-blue-400">{{ requests.length }}</div>
        <div class="text-sm text-gray-300">{{ 'TOTAL_REQUESTS' | translate }}</div>
      </div>
      <div class="bg-gray-700 rounded p-3 text-center">
        <div class="text-2xl font-bold text-green-400">{{ sessions.length }}</div>
        <div class="text-sm text-gray-300">{{ 'ACTIVE_SESSIONS' | translate }}</div>
      </div>
      <div class="bg-gray-700 rounded p-3 text-center">
        <div class="text-2xl font-bold text-yellow-400">{{ debugHistory.length }}</div>
        <div class="text-sm text-gray-300">{{ 'DEBUG_MESSAGES' | translate }}</div>
      </div>
    </div>

    <!-- Histórico de Mensagens de Controle -->
    <div class="mb-4">
      <h4 class="text-md font-semibold text-white mb-2">{{ 'CONTROL_MESSAGES_HISTORY' | translate }}</h4>
      <div class="max-h-48 overflow-y-auto space-y-2">
        @if (debugHistory.length === 0) {
          <p class="text-gray-400 text-sm">{{ 'NO_DEBUG_MESSAGES' | translate }}</p>
        } @else {
          @for (message of debugHistory; track message.requestId + message.timestamp) {
            <div class="bg-gray-700 rounded p-2 text-sm">
              <div class="flex justify-between items-start mb-1">
                <span class="font-medium text-white">{{ getMessageTypeLabel(message.type) }}</span>
                <span class="text-gray-400 text-xs">{{ message.timestamp | date:'short' }}</span>
              </div>
              <div class="text-gray-300">
                <div>{{ 'FROM' | translate }}: {{ message.from }} → {{ 'TO' | translate }}: {{ message.to }}</div>
                <div>{{ 'REQUEST_ID' | translate }}: {{ message.requestId }}</div>
                @if (message.sessionTopic) {
                  <div>{{ 'SESSION_TOPIC' | translate }}: {{ message.sessionTopic }}</div>
                }
              </div>
            </div>
          }
        }
      </div>
    </div>

    <!-- Lista de Solicitações -->
    <div class="mb-4">
      <h4 class="text-md font-semibold text-white mb-2">{{ 'ALL_REQUESTS' | translate }}</h4>
      <div class="max-h-32 overflow-y-auto space-y-1">
        @if (requests.length === 0) {
          <p class="text-gray-400 text-sm">{{ 'NO_REQUESTS' | translate }}</p>
        } @else {
          @for (request of requests; track request.id) {
            <div class="bg-gray-700 rounded p-2 text-sm">
              <div class="flex justify-between items-center">
                <span class="text-white">{{ request.from }} → {{ request.to }}</span>
                <span class="text-xs px-2 py-1 rounded" 
                      [class]="request.status === 'pending' ? 'bg-yellow-600' : 
                               request.status === 'accepted' ? 'bg-green-600' : 'bg-red-600'">
                  {{ getStatusLabel(request.status) }}
                </span>
              </div>
              @if (request.sessionTopic) {
                <div class="text-gray-400 text-xs mt-1">{{ 'TOPIC' | translate }}: {{ request.sessionTopic }}</div>
              }
            </div>
          }
        }
      </div>
    </div>

    <!-- Sessões Ativas -->
    <div>
      <h4 class="text-md font-semibold text-white mb-2">{{ 'ACTIVE_SESSIONS' | translate }}</h4>
      <div class="max-h-32 overflow-y-auto space-y-1">
        @if (sessions.length === 0) {
          <p class="text-gray-400 text-sm">{{ 'NO_ACTIVE_SESSIONS' | translate }}</p>
        } @else {
          @for (session of sessions; track session.id) {
            <div class="bg-gray-700 rounded p-2 text-sm">
              <div class="text-white">{{ session.participants[0] }} ↔ {{ session.participants[1] }}</div>
              <div class="text-gray-400 text-xs">{{ 'TOPIC' | translate }}: {{ session.topic }}</div>
              <div class="text-gray-400 text-xs">{{ 'CREATED' | translate }}: {{ session.createdAt | date:'short' }}</div>
            </div>
          }
        }
      </div>
    </div>
  }
</div>
